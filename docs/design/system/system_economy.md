# Economy System Spec (Design)

이 문서는 ClickerGame의 경제 규칙(수식/정책/제약)을 정의한다.
런타임 호출 순서, Public API, 이벤트 계약, 데이터 모델의 소유권은 `docs/tech/api_reference.md`에 기재한다.

---

## 1. 의도
- 경제 시스템의 핵심 루프와 수식/규칙을 문서화
- 수식 변경/확장 시 가이드라인을 제공
- 밸런스 패치를 할 때 안전한 변경 범위를 명시

---

## 2. 경제 시스템 목표
- 짧은 세션에서도 즉각적 보상(클릭 수익)으로 성취감을 제공
- CPS 기반 패시브 수익과 오프라인 보상으로 복귀 동기를 제공
- 업그레이드는 "단순 반복"이 아닌 명확한 성장(레벨 기반 증가)를 제공

---

## 3. 핵심 루프

1. 클릭 -> Currency 획득 (CPC)
2. 업그레이드 구매 -> CPC/CPS 증가(정책에 따라)
3. 오프라인 보상 수령 -> 루프 재진입

> **Note** UI 갱신/저장/로드/이벤트 브로드캐스트의 실제 실행 흐름은 `api_reference`에서 확인 가능

---

## 4. 수식/규칙

### 4.1 기본 정의
- L = Upgrade Level
- Base = 기본 계수(프로젝트에서 정의된 상수 혹은 설정값)

#### CPC
- CPC = Base + L
  - Base: 현재 기본값 1로 설정 (추후 조정 가능)

#### CPS
- CPS = Base + L/2
  - Base: 현재 기본값 2로 설정 (추후 조정 가능)

> **Note** 현재 단순한 1차 모델이며, 추후 분기/보정계수 도입 가능.

---

### 4.2 오프라인 보상
- OfflineReward = CPS * OfflineSeconds
- OfflineSeconds는 다음 규칙을 따름
  - `OfflineSeconds = Clamp(NowUTC - LastSaveTimeUTC, 0, 28800)`
  - 최대 누적 제한 시간: 8시간(28800)

**중복 지급 방지 규칙**
- 오프라인 보상 적용 직후 LastSaveTime 갱신 + 즉시 저장 수행

---

### 4.3 업그레이드 비용
- Cost(Level) = BaseCost * Growth^Level
- 요구 조건:
  - Cost는 단조 증가(Non-decreasing)
  - Growth는 일반적으로 1.0 초과(>1)로 유지
  - Overflow/정밀도 (특히 double)을 고려

- 구매 성공 시:
  - Currency 감소
  - Level 증가
  - CPC/CPS 재계산(정책 적용)
  - UI 갱신 이벤트 발생

## 5. 확장(로드맵)
> 현재는 1차 모델(선형 CPC/CPS + 지수 Cost)이며, 아래는 확장 후보
- 티어 구조:
  - 10티어 * 티어당 5 레벨
- 티어별 보정:
  - 티어 진입 시 CPC/CPS 성장률 변화
  - 특정 티어에서 신규 리소스/멀티플레이어 도입
- 오프라인 보상 정책 확장:
  - 특정 업그레이드로 오프라인 보상 캡 증가
  - 오프라인 보상 효율(감쇠/보너스)도입

## 6. UX 플로우 (경제)
### 6.1 첫 진입(향후)
1. 튜토리얼
2. 첫 보상 토스트
3. 업그레이드 안내

### 6.2 반복 루프(현재)
1. 클릭 / 업그레이드
2. Economy 상태 변화
3. UI는 이벤트를 통해 갱신
4. 자동 저장(주기) 또는 수동 저장(버튼)

> **Note** UI 갱신/저장의 정확한 타이밍은 `api_reference` 참조

